select worktype,count(*) from (select k.*,case when k.[Work Type] in('PDM','PM','PMCAL','PMSN') then 'PM'	when k.[Work Type] in('MA') and  h.HRS < 72 then 'RM'	when k.[Work Type] in('RPM','RPDM','MA,MI','SD') and  h.HRS > 72 then 'CM' end worktypefrom [Asset Analytix WorkOrder table_all] kleft join(select c.[Work Order],DATEDIFF(hour,[Reported Date],startdate) HRSfrom (select a.[Work Order] [Work Order], b.refwo,a.[Reported Date],min(startdate)startdate from[dbo].[Asset Analytix WorkOrder table_all]  aleft join [Lilly_PMO].dbo.Client_Labtrans_ALL bon a.[Work Order]=b.refwo and a.Site=b.SITEIDwhere a.Site='DAF' and b.SITEID='DAF'and  [Work Type] not in('PDM','PM','PMCAL','PMSN')group by a.[Work Order],b.refwo,a.[Reported Date])c)hon k.[Work Order]=h.[Work Order]where --k.[Reported Date] >='2021-04-01' and k.[Reported Date] <='2022-03-31' k.[Reported Date] >='2021-04-01' and k.[Reported Date] <='2022-03-31')lgroup by worktype